// Prisma Schema for Momentum
// https://pris.ly/d/prisma-schema

generator client {
  provider     = "prisma-client"
  output       = "../src/generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

model User {
  id              String    @id @default(uuid())
  email           String    @unique
  passwordHash    String    @map("password_hash")
  name            String
  birthDate       DateTime? @map("birth_date") @db.Date
  height          Float?    // in cm
  goalDescription String?   @map("goal_description")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  measurements    Measurement[]
  workouts        Workout[]

  @@map("users")
}

model Measurement {
  id            String   @id @default(uuid())
  userId        String   @map("user_id")
  user          User     @relation(fields: [userId], references: [id])
  date          DateTime @db.Date

  // Weight in kg
  weight        Float?

  // Upper body (cm)
  neck          Float?
  shoulders     Float?
  chest         Float?

  // Arms (cm) - bilateral
  bicepsLeft    Float?   @map("biceps_left")
  bicepsRight   Float?   @map("biceps_right")
  forearmLeft   Float?   @map("forearm_left")
  forearmRight  Float?   @map("forearm_right")
  wristLeft     Float?   @map("wrist_left")
  wristRight    Float?   @map("wrist_right")

  // Core (cm)
  waist         Float?
  hips          Float?

  // Legs (cm) - bilateral
  thighLeft     Float?   @map("thigh_left")
  thighRight    Float?   @map("thigh_right")
  calfLeft      Float?   @map("calf_left")
  calfRight     Float?   @map("calf_right")
  ankleLeft     Float?   @map("ankle_left")
  ankleRight    Float?   @map("ankle_right")

  notes         String?
  createdAt     DateTime @default(now()) @map("created_at")

  @@unique([userId, date])
  @@map("measurements")
}

model Exercise {
  id           String   @id @default(uuid())
  name         String
  muscleGroups String[] @map("muscle_groups")
  createdAt    DateTime @default(now()) @map("created_at")

  workoutItemExercises WorkoutItemExercise[]

  @@map("exercises")
}

model Workout {
  id          String   @id @default(uuid())
  userId      String   @map("user_id")
  user        User     @relation(fields: [userId], references: [id])
  name        String
  description String?
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  items WorkoutItem[]

  @@map("workouts")
}

model WorkoutItem {
  id        String  @id @default(uuid())
  workoutId String  @map("workout_id")
  workout   Workout @relation(fields: [workoutId], references: [id], onDelete: Cascade)
  type      String  // 'exercise' | 'superset'
  position  Int     // order in workout
  rounds    Int     @default(1) // number of rounds (1 for simple exercise, N for superset)
  restAfter Int     @map("rest_after") // seconds, rest after this item

  exercises WorkoutItemExercise[]

  @@index([workoutId, position])
  @@map("workout_items")
}

model WorkoutItemExercise {
  id              String      @id @default(uuid())
  workoutItemId   String      @map("workout_item_id")
  workoutItem     WorkoutItem @relation(fields: [workoutItemId], references: [id], onDelete: Cascade)
  exerciseId      String      @map("exercise_id")
  exercise        Exercise    @relation(fields: [exerciseId], references: [id])
  position        Int         // order in item (1 for simple, 1-N for superset)
  restBetweenSets Int         @map("rest_between_sets") // seconds

  sets WorkoutSet[]

  @@index([workoutItemId, position])
  @@map("workout_item_exercises")
}

model WorkoutSet {
  id                    String              @id @default(uuid())
  workoutItemExerciseId String              @map("workout_item_exercise_id")
  workoutItemExercise   WorkoutItemExercise @relation(fields: [workoutItemExerciseId], references: [id], onDelete: Cascade)
  setNumber             Int                 @map("set_number")
  targetReps            Int                 @map("target_reps")
  targetWeight          Float?              @map("target_weight") // kg, nullable

  @@index([workoutItemExerciseId, setNumber])
  @@map("workout_sets")
}
