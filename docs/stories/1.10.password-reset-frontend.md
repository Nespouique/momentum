# Story 1.10: Password Reset - Frontend Pages

## Status: Draft

## Dependencies
- Story 1.9 (Password Reset Backend) must be completed first

## Story
**As a** user who has forgotten my password,
**I want** to use a "Mot de passe oublié" flow from the login page,
**so that** I can reset my password via the link received by email.

## Acceptance Criteria
1. Login page has a "Mot de passe oublié ?" link below the password field
2. `/forgot-password` page with email input and submit button
3. After submit, confirmation message displayed ("Si un compte existe avec cet email, un lien de réinitialisation a été envoyé") regardless of result
4. `/reset-password?token=xxx` page with new password + confirmation fields
5. Password validation: minimum 8 characters, passwords must match
6. On successful reset: success message + link/redirect to login page
7. On invalid/expired token: error message with link to request a new one
8. Loading states on all form submissions
9. All text in French, consistent with existing auth pages styling
10. Pages accessible without authentication (public routes)

## Tasks / Subtasks
- [ ] Add API client functions (AC: 2, 4)
  - [ ] Add `forgotPassword(email)` to `src/lib/api/auth.ts` → `POST /backend/auth/forgot-password`
  - [ ] Add `resetPassword(token, password)` to `src/lib/api/auth.ts` → `POST /backend/auth/reset-password`
- [ ] Add Zod validation schemas (AC: 5)
  - [ ] Add `forgotPasswordSchema` to `src/lib/validations/auth.ts`
  - [ ] Add `resetPasswordSchema` to `src/lib/validations/auth.ts` (password + confirmPassword + refine match)
- [ ] Add "Mot de passe oublié" link on login (AC: 1)
  - [ ] Add link below password field in `app/(auth)/login/page.tsx`
  - [ ] Style consistent with existing "Pas encore de compte ?" link
- [ ] Create forgot-password page (AC: 2, 3, 8, 9)
  - [ ] Create `app/(auth)/forgot-password/page.tsx`
  - [ ] Email input with React Hook Form + Zod
  - [ ] Submit button with loading spinner
  - [ ] Success state: confirmation message (always same message, no email leak)
  - [ ] Card layout matching login/register pages
- [ ] Create reset-password page (AC: 4, 5, 6, 7, 8, 9)
  - [ ] Create `app/(auth)/reset-password/page.tsx`
  - [ ] Read `token` from URL search params
  - [ ] Two password fields (new + confirm) with React Hook Form + Zod
  - [ ] Submit button with loading spinner
  - [ ] Success state: message + "Retour à la connexion" link
  - [ ] Error state: message explaining token invalid/expired + "Demander un nouveau lien" link
- [ ] Ensure public route access (AC: 10)
  - [ ] Verify Next.js middleware allows `/forgot-password` and `/reset-password` without auth
  - [ ] Both pages under `(auth)` layout group (already public)

## Dev Notes

### New Routes
Both pages go under the existing `(auth)` layout group which is already public:
```
app/(auth)/forgot-password/page.tsx
app/(auth)/reset-password/page.tsx
```

### API Client Functions
```typescript
// In src/lib/api/auth.ts
export async function forgotPassword(email: string): Promise<void> {
  await fetch(`${API_URL}/backend/auth/forgot-password`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email }),
  });
  // Always succeed from client perspective (no email leak)
}

export async function resetPassword(token: string, password: string): Promise<void> {
  const res = await fetch(`${API_URL}/backend/auth/reset-password`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ token, password }),
  });
  if (!res.ok) {
    const data = await res.json();
    throw new AuthError(data.error?.message, data.error?.code);
  }
}
```

### Validation Schemas
```typescript
export const forgotPasswordSchema = z.object({
  email: z.string().email("Veuillez entrer une adresse e-mail valide"),
});

export const resetPasswordSchema = z
  .object({
    password: z.string().min(8, "Le mot de passe doit contenir au moins 8 caractères"),
    confirmPassword: z.string(),
  })
  .refine((data) => data.password === data.confirmPassword, {
    message: "Les mots de passe ne correspondent pas",
    path: ["confirmPassword"],
  });
```

### UI Text (French)
- Forgot password page title: "Mot de passe oublié"
- Forgot password subtitle: "Entrez votre adresse e-mail pour recevoir un lien de réinitialisation"
- Forgot password button: "Envoyer le lien"
- Forgot password success: "Si un compte existe avec cet e-mail, un lien de réinitialisation a été envoyé. Vérifiez votre boîte de réception."
- Reset password page title: "Nouveau mot de passe"
- Reset password button: "Réinitialiser le mot de passe"
- Reset success: "Votre mot de passe a été réinitialisé avec succès."
- Reset error (expired): "Ce lien a expiré. Veuillez demander un nouveau lien de réinitialisation."
- Reset error (invalid): "Ce lien est invalide. Veuillez demander un nouveau lien de réinitialisation."

### Next.js Middleware
The existing middleware in `apps/web/src/middleware.ts` should already allow `(auth)` group pages. Verify that `/forgot-password` and `/reset-password` are not being redirected to login.

## Testing
- Login page shows "Mot de passe oublié ?" link
- Click link navigates to /forgot-password
- Submit email → shows confirmation message
- Submit invalid email format → validation error
- Open reset link from email → shows password form
- Submit matching passwords (8+ chars) → success + link to login
- Submit non-matching passwords → validation error
- Submit short password → validation error
- Open reset link with invalid token → error message + "new link" option
- Open reset link with expired token → error message + "new link" option
- After successful reset, login with new password works

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-05 | 0.1 | Story creation | PM John |
