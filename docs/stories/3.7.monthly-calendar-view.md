# Story 3.7: Monthly Goals & Calendar View

## Status: Draft

## Story
**As a** user,
**I want** to see my monthly progress in a calendar format,
**so that** I can visualize which days I was active and plan my remaining days.

## Acceptance Criteria
1. Composant calendrier mensuel accessible depuis le dashboard ou stats
2. Chaque jour colorÃ© selon le niveau de complÃ©tion (gradient ou dots)
3. LÃ©gende claire des couleurs
4. Affichage du nombre de jours actifs vs objectif mensuel
5. Projection : "Il te reste X jours pour atteindre ton objectif de Y jours"
6. Navigation entre les mois (historique)
7. Clic sur un jour affiche le dÃ©tail de ce jour (items complÃ©tÃ©s)
8. Vue responsive : simplifiÃ© sur mobile, complet sur desktop

## Tasks / Subtasks
- [ ] CrÃ©er composant TrackingCalendar (AC: 1)
  - [ ] Grille calendrier mensuel
  - [ ] Accessible depuis stats ou bouton dashboard
  - [ ] Props: trackableId (optionnel, sinon global)
- [ ] ImplÃ©menter coloration des jours (AC: 2)
  - [ ] Fetch entries pour le mois
  - [ ] Calculer niveau de complÃ©tion par jour
  - [ ] Gradient: rouge (0%) â†’ orange (50%) â†’ vert (100%)
  - [ ] Ou dots colorÃ©s par trackable
- [ ] Ajouter lÃ©gende (AC: 3)
  - [ ] Barre de gradient avec labels
  - [ ] "Less" â† â†’ "More"
  - [ ] Ou lÃ©gende par couleur de trackable
- [ ] Afficher stats du mois (AC: 4)
  - [ ] "15 active days this month"
  - [ ] Progress bar vs objectif
  - [ ] Comparaison avec mois prÃ©cÃ©dent (optionnel)
- [ ] Calculer projection (AC: 5)
  - [ ] "You need X more days to reach your goal"
  - [ ] "On track!" si faisable
  - [ ] "Goal achieved!" si dÃ©jÃ  atteint
- [ ] Navigation entre mois (AC: 6)
  - [ ] Boutons < Prev | Next >
  - [ ] Afficher "January 2024"
  - [ ] Limiter Ã  12 mois d'historique
  - [ ] Charger donnÃ©es du nouveau mois
- [ ] DÃ©tail du jour au clic (AC: 7)
  - [ ] Popover ou modal au clic sur un jour
  - [ ] Liste des trackables avec status
  - [ ] Permettre de naviguer vers /tracking/:date
- [ ] Vue responsive (AC: 8)
  - [ ] Mobile: calendrier compact, dots simples
  - [ ] Desktop: calendrier complet avec dÃ©tails

## Dev Notes

### Calendar Layout (Desktop)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â†  January 2024  â†’                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Mon   Tue   Wed   Thu   Fri   Sat   Sun       â”‚
â”‚  â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”   â”‚
â”‚  â”‚ 1 â”‚ â”‚ 2 â”‚ â”‚ 3 â”‚ â”‚ 4 â”‚ â”‚ 5 â”‚ â”‚ 6 â”‚ â”‚ 7 â”‚   â”‚
â”‚  â”‚ ğŸŸ¢â”‚ â”‚ ğŸŸ¢â”‚ â”‚ ğŸŸ¡â”‚ â”‚ ğŸ”´â”‚ â”‚ ğŸŸ¢â”‚ â”‚ ğŸŸ¢â”‚ â”‚ âš«â”‚   â”‚
â”‚  â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”   â”‚
â”‚  â”‚ 8 â”‚ â”‚ 9 â”‚ â”‚10 â”‚ â”‚11 â”‚ â”‚12 â”‚ â”‚13 â”‚ â”‚14 â”‚   â”‚
â”‚  â”‚ ğŸŸ¢â”‚ â”‚ ğŸŸ¢â”‚ â”‚ ğŸŸ¢â”‚ â”‚ ğŸŸ¡â”‚ â”‚ ğŸŸ¢â”‚ â”‚ ğŸŸ¢â”‚ â”‚ ğŸŸ¢â”‚   â”‚
â”‚  â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜   â”‚
â”‚  ...                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Legend: ğŸŸ¢ 100%  ğŸŸ¡ 50%  ğŸ”´ <50%  âš« 0%        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  15 active days Â· Goal: 20/month                â”‚
â”‚  â–“â–“â–“â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘  75%                             â”‚
â”‚  "5 more days needed, 16 days remaining"        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Calendar Layout (Mobile)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    â†  Jan 2024  â†’           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  M  T  W  T  F  S  S        â”‚
â”‚  ğŸŸ¢ ğŸŸ¢ ğŸŸ¡ ğŸ”´ ğŸŸ¢ ğŸŸ¢ âš«        â”‚
â”‚  ğŸŸ¢ ğŸŸ¢ ğŸŸ¢ ğŸŸ¡ ğŸŸ¢ ğŸŸ¢ ğŸŸ¢        â”‚
â”‚  ...                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  15/20 days Â· 5 to go       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Completion Level Calculation
```typescript
interface DayCompletion {
  date: Date;
  completedCount: number;
  totalCount: number;
  percentage: number;
  entries: DailyEntry[];
}

const getCompletionLevel = (percentage: number): CompletionLevel => {
  if (percentage === 0) return 'none';
  if (percentage < 50) return 'low';
  if (percentage < 100) return 'medium';
  return 'full';
};

const completionColors = {
  none: 'bg-muted',
  low: 'bg-red-500/60',
  medium: 'bg-yellow-500/60',
  full: 'bg-green-500/60',
};
```

### Data Fetching
```typescript
// hooks/useCalendarData.ts
export function useCalendarData(year: number, month: number, trackableId?: string) {
  return useQuery({
    queryKey: ['calendar', year, month, trackableId],
    queryFn: async () => {
      const startDate = startOfMonth(new Date(year, month));
      const endDate = endOfMonth(new Date(year, month));

      const entries = await api.get('/tracking/entries', {
        params: {
          from: format(startDate, 'yyyy-MM-dd'),
          to: format(endDate, 'yyyy-MM-dd'),
          trackableId,
        },
      });

      return processEntriesForCalendar(entries.data);
    },
  });
}
```

### Day Detail Popover
```tsx
interface DayDetailProps {
  date: Date;
  entries: DailyEntry[];
  onClose: () => void;
}

// Content
<Popover>
  <PopoverTrigger>{dayCell}</PopoverTrigger>
  <PopoverContent>
    <h4>{format(date, 'EEEE, MMM d')}</h4>
    <ul>
      {entries.map(entry => (
        <li key={entry.id}>
          {entry.trackable.icon} {entry.trackable.name}
          {entry.value > 0 ? 'âœ“' : 'âœ—'}
        </li>
      ))}
    </ul>
    {entries.length === 0 && <p>No activity</p>}
  </PopoverContent>
</Popover>
```

### Projection Logic
```typescript
const calculateProjection = (
  activeDays: number,
  goalDays: number,
  daysInMonth: number,
  currentDay: number
): ProjectionResult => {
  const daysRemaining = daysInMonth - currentDay;
  const daysNeeded = goalDays - activeDays;

  if (daysNeeded <= 0) {
    return {
      status: 'achieved',
      message: 'Goal achieved! ğŸ¯',
    };
  }

  if (daysNeeded <= daysRemaining) {
    return {
      status: 'on-track',
      message: `${daysNeeded} more days needed, ${daysRemaining} days remaining`,
    };
  }

  return {
    status: 'behind',
    message: `Need ${daysNeeded} days but only ${daysRemaining} remaining`,
  };
};
```

### Navigation State
```typescript
const [currentMonth, setCurrentMonth] = useState(new Date());

const goToPreviousMonth = () => {
  setCurrentMonth(subMonths(currentMonth, 1));
};

const goToNextMonth = () => {
  const next = addMonths(currentMonth, 1);
  // Don't go past current month
  if (!isAfter(next, new Date())) {
    setCurrentMonth(next);
  }
};
```

### Components
- Calendar (custom ou react-day-picker)
- Popover (Shadcn)
- Button (navigation)
- Progress (stats bar)
- Card

### Accessibility
- Keyboard navigation dans le calendrier
- ARIA labels pour les jours
- Focus visible sur les cellules
- Screen reader: "January 15, 3 of 4 habits completed"

## Testing
- Tester affichage calendrier du mois courant
- Tester coloration correcte selon completion
- Tester navigation prev/next month
- Tester limite (pas de futur, max 12 mois passÃ©)
- Tester clic sur jour affiche dÃ©tail
- Tester projection correcte
- Tester responsive mobile/desktop
- Tester avec trackableId spÃ©cifique

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-17 | 0.1 | Initial story creation | PO Sarah |
