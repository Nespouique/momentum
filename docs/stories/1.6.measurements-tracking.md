# Story 1.6: Measurements Tracking

## Status: Draft

## Story
**As a** user,
**I want** to record and view my body measurements over time,
**so that** I can track my physical progress.

## Acceptance Criteria
1. Modèle `Measurement` créé avec champs bilatéraux complets :
   - `userId, date, notes`
   - `weight` (kg)
   - Mesures en cm : `neck, shoulders, chest, bicepsLeft, bicepsRight, forearmLeft, forearmRight, wristLeft, wristRight, waist, hips, thighLeft, thighRight, calfLeft, calfRight, ankleLeft, ankleRight`
2. Endpoints API : `GET /measurements`, `GET /measurements/:id`, `POST /measurements`, `PUT /measurements/:id`, `DELETE /measurements/:id`, `GET /measurements/latest`, `GET /measurements/progress`
3. Page `/profile/measurements` listant l'historique des mensurations (plus récentes en premier)
4. Formulaire d'ajout de mensuration avec date picker et champs optionnels groupés par zone corporelle
5. Possibilité de modifier et supprimer une entrée
6. Affichage des unités (kg, cm)
7. Navigation vers mensurations depuis le profil hub

## Tasks / Subtasks
- [ ] Créer modèle Measurement (AC: 1)
  - [ ] Créer migration Prisma avec tous les champs
  - [ ] Relation avec User (userId)
  - [ ] Tous les champs mesure sont optionnels (Float?)
  - [ ] Contrainte unique sur (userId, date)
- [ ] Créer endpoints CRUD (AC: 2)
  - [ ] GET /measurements - liste paginée, triée par date desc
  - [ ] GET /measurements/:id - détail d'une mesure
  - [ ] POST /measurements - créer nouvelle mesure
  - [ ] PUT /measurements/:id - modifier une mesure
  - [ ] DELETE /measurements/:id - supprimer une mesure
  - [ ] GET /measurements/latest - dernière mesure
  - [ ] GET /measurements/progress?field=weight&period=3months
- [ ] Créer page liste mensurations (AC: 3)
  - [ ] Créer `app/(app)/profile/measurements/page.tsx`
  - [ ] Liste avec cards: date, poids, preview des mesures clés
  - [ ] Bouton "Ajouter" en haut
  - [ ] Tri par date décroissante
- [ ] Créer formulaire d'ajout (AC: 4)
  - [ ] Page ou modal pour création/édition
  - [ ] Date picker pour la date
  - [ ] Grouper les champs par zone:
    - Poids
    - Haut du corps (cou, épaules, poitrine)
    - Bras (biceps L/R, avant-bras L/R, poignet L/R)
    - Tronc (taille, hanches)
    - Jambes (cuisse L/R, mollet L/R, cheville L/R)
  - [ ] Notes optionnelles
- [ ] Actions modifier/supprimer (AC: 5)
  - [ ] Bouton edit sur chaque card → formulaire pré-rempli
  - [ ] Bouton delete avec confirmation Dialog
  - [ ] Optimistic update pour UX fluide
- [ ] Affichage unités (AC: 6)
  - [ ] Afficher "kg" pour poids, "cm" pour mesures
  - [ ] Formater les nombres (1 décimale)
- [ ] Navigation (AC: 7)
  - [ ] Lien depuis Profile Hub → Measurements
  - [ ] Bouton retour vers profil

## Dev Notes

### Prisma Schema
```prisma
model Measurement {
  id            String   @id @default(uuid())
  userId        String   @map("user_id")
  user          User     @relation(fields: [userId], references: [id])
  date          DateTime @db.Date

  // Weight in kg
  weight        Float?

  // Upper body (cm)
  neck          Float?
  shoulders     Float?
  chest         Float?

  // Arms (cm) - bilateral
  bicepsLeft    Float?   @map("biceps_left")
  bicepsRight   Float?   @map("biceps_right")
  forearmLeft   Float?   @map("forearm_left")
  forearmRight  Float?   @map("forearm_right")
  wristLeft     Float?   @map("wrist_left")
  wristRight    Float?   @map("wrist_right")

  // Core (cm)
  waist         Float?
  hips          Float?

  // Legs (cm) - bilateral
  thighLeft     Float?   @map("thigh_left")
  thighRight    Float?   @map("thigh_right")
  calfLeft      Float?   @map("calf_left")
  calfRight     Float?   @map("calf_right")
  ankleLeft     Float?   @map("ankle_left")
  ankleRight    Float?   @map("ankle_right")

  notes         String?
  createdAt     DateTime @default(now()) @map("created_at")

  @@unique([userId, date])
  @@map("measurements")
}
```

### API Response Format
```typescript
// GET /measurements/progress?field=weight&period=3months
{
  field: "weight",
  period: "3months",
  data: [
    { date: "2024-01-01", value: 77 },
    { date: "2024-01-08", value: 76.5 },
    { date: "2024-01-15", value: 75.5 }
  ],
  change: -1.5,
  changePercent: -1.95
}
```

### Form Groups UI
```
┌─────────────────────────────┐
│ Date: [    Date Picker    ] │
├─────────────────────────────┤
│ POIDS                       │
│ [  75.5  ] kg               │
├─────────────────────────────┤
│ HAUT DU CORPS               │
│ Cou:      [  38  ] cm       │
│ Épaules:  [ 115  ] cm       │
│ Poitrine: [ 100  ] cm       │
├─────────────────────────────┤
│ BRAS                        │
│ Biceps:   L[ 35 ] R[ 35 ]cm │
│ Avant-bras: L[28] R[28] cm  │
│ Poignet:  L[ 17 ] R[ 17 ]cm │
├─────────────────────────────┤
│ TRONC                       │
│ Taille:   [  82  ] cm       │
│ Hanches:  [  95  ] cm       │
├─────────────────────────────┤
│ JAMBES                      │
│ Cuisse:   L[ 58 ] R[ 58 ]cm │
│ Mollet:   L[ 38 ] R[ 38 ]cm │
│ Cheville: L[ 23 ] R[ 23 ]cm │
├─────────────────────────────┤
│ Notes: [                  ] │
├─────────────────────────────┤
│     [ Sauvegarder ]         │
└─────────────────────────────┘
```

### Components Shadcn
- Calendar / DatePicker
- Card
- Input
- Dialog (pour confirmation delete)
- Collapsible (pour grouper les champs)

## Testing
- Tester création d'une mesure avec tous les champs
- Tester création avec seulement le poids
- Tester qu'on ne peut pas créer 2 mesures à la même date
- Tester modification d'une mesure existante
- Tester suppression avec confirmation
- Tester GET /measurements/latest retourne la plus récente
- Tester GET /measurements/progress calcule correctement le changement

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-17 | 0.1 | Initial story creation | PO Sarah |
