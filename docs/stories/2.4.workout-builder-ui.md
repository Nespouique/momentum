# Story 2.4: Workout Builder - UI

## Status: Draft

## Story
**As a** user,
**I want** to create and edit my workout programs,
**so that** I can structure my training sessions according to my split.

## Acceptance Criteria
1. Page `/workouts` listant mes programmes avec nom et description
2. Bouton "Nouveau programme" crÃ©ant un nouveau workout
3. Page `/workouts/new` et `/workouts/:id/edit` pour crÃ©ation/Ã©dition
4. Champs : nom du programme (requis), description (optionnel, texte libre)
5. Section "Exercices" avec liste ordonnÃ©e des exercices du programme
6. Bouton "Ajouter exercice" ouvrant sÃ©lecteur (ExerciseSelector) depuis la bibliothÃ¨que
7. Pour chaque exercice : sets cibles, reps cibles, poids cible (optionnel), repos entre sÃ©ries (input en secondes), repos aprÃ¨s exercice (input en secondes)
8. PossibilitÃ© de rÃ©ordonner les exercices (drag & drop ou boutons up/down)
9. PossibilitÃ© de retirer un exercice du programme
10. Sauvegarde avec feedback visuel (loading, success, error)

## Tasks / Subtasks
- [ ] CrÃ©er page liste workouts (AC: 1)
  - [ ] CrÃ©er `app/(app)/workouts/page.tsx`
  - [ ] Fetch workouts avec React Query
  - [ ] Afficher cards avec nom, description, nb exercices
  - [ ] Bouton "Start" pour chaque workout
- [ ] Bouton nouveau programme (AC: 2)
  - [ ] Bouton "+" ou "Nouveau programme" en header
  - [ ] Navigation vers /workouts/new
- [ ] CrÃ©er pages builder (AC: 3)
  - [ ] `app/(app)/workouts/new/page.tsx`
  - [ ] `app/(app)/workouts/[id]/edit/page.tsx`
  - [ ] RÃ©utiliser mÃªme composant WorkoutBuilder
- [ ] Formulaire infos workout (AC: 4)
  - [ ] Input nom (requis)
  - [ ] Textarea description (optionnel)
  - [ ] Validation avec React Hook Form + Zod
- [ ] Section exercices (AC: 5)
  - [ ] Liste des exercices ajoutÃ©s
  - [ ] Afficher ordre numÃ©rotÃ©
  - [ ] Composant ExerciseRow pour chaque exercice
- [ ] ExerciseSelector (AC: 6)
  - [ ] Bouton "Ajouter exercice" ouvre Dialog/Drawer
  - [ ] RÃ©utiliser composants de la page exercices
  - [ ] Recherche et filtres
  - [ ] Clic sur exercice l'ajoute au workout
- [ ] Configuration par exercice (AC: 7)
  - [ ] Inputs inline ou expandable pour chaque exercice:
    - Sets cibles (number, dÃ©faut 3)
    - Reps cibles (number, dÃ©faut 10)
    - Poids cible (number, optionnel)
    - Repos entre sÃ©ries (number, dÃ©faut 90)
    - Repos aprÃ¨s exercice (number, dÃ©faut 120)
  - [ ] Affichage compact: "4Ã—10 @ 60kg Â· 90s Â· 120s"
- [ ] RÃ©ordonner exercices (AC: 8)
  - [ ] Installer dnd-kit ou @hello-pangea/dnd
  - [ ] Drag handle sur chaque exercice
  - [ ] Ou boutons â†‘ â†“ pour monter/descendre
  - [ ] Mettre Ã  jour order aprÃ¨s rÃ©organisation
- [ ] Retirer exercice (AC: 9)
  - [ ] Bouton trash sur chaque exercice
  - [ ] Confirmation optionnelle
  - [ ] Retirer de la liste locale
- [ ] Sauvegarde (AC: 10)
  - [ ] Bouton "Sauvegarder" en header ou footer
  - [ ] Loading state pendant requÃªte
  - [ ] Toast success aprÃ¨s sauvegarde
  - [ ] Afficher erreurs si Ã©chec
  - [ ] Redirection vers /workouts aprÃ¨s succÃ¨s

## Dependencies
- Story 2.3: Workout Program Backend (API endpoints)
- Story 2.2: Exercise Library UI (ExerciseSelector rÃ©utilisable)
- Story 1.3: Shadcn UI & Dark Theme (composants de base)
- Story 1.5: User Profile Management (composant NumberInput)

## Dev Notes

### Composants rÃ©utilisables de l'Epic 1
- **NumberInput** (Story 1.5) - Stepper +/- pour sets, reps, poids, temps de repos
  - DÃ©jÃ  configurÃ© avec incrÃ©ments et limites
  - RÃ©utiliser pour tous les champs numÃ©riques du builder
- **Input, Button, Card, Textarea** - Story 1.4
- **Dialog** - Story 1.6 (pour ExerciseSelector)
- **Sonner (toasts)** - Story 1.5 (feedback sauvegarde)

### API Client (ref Story 1.7)
L'API utilise un proxy Next.js:
```typescript
// Les appels passent par /backend/
// Le client API dans src/lib/api/ gÃ¨re dÃ©jÃ  ce prefix
```

### Page Workouts List
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Workouts               + New   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ’ª START A WORKOUT     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  MY PROGRAMS                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Push Day                â”‚   â”‚
â”‚  â”‚ Chest, shoulders        â”‚   â”‚
â”‚  â”‚ 6 exercises    â–¶ Start  â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ Pull Day                â”‚   â”‚
â”‚  â”‚ Back, biceps            â”‚   â”‚
â”‚  â”‚ 5 exercises    â–¶ Start  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Workout Builder Layout
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† Back            Save         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚  Program Name                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Push Day                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â”‚  Description                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Chest, shoulders, tri   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  EXERCISES                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â‰¡ 1. Bench Press        â”‚   â”‚
â”‚  â”‚    4Ã—10 @ 60kg          â”‚   â”‚
â”‚  â”‚    90s rest Â· 120s afterâ”‚   â”‚
â”‚  â”‚              âœ    ğŸ—‘    â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ â‰¡ 2. Incline Press      â”‚   â”‚
â”‚  â”‚    3Ã—12 Â· 60s Â· 90s     â”‚   â”‚
â”‚  â”‚              âœ    ğŸ—‘    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  + Add Exercise         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ExerciseRow Component
```tsx
interface ExerciseRowProps {
  exercise: WorkoutExercise;
  onUpdate: (data: Partial<WorkoutExercise>) => void;
  onRemove: () => void;
  onMoveUp?: () => void;
  onMoveDown?: () => void;
  dragHandleProps?: any; // pour dnd-kit
}
```

### State Management
```typescript
// Local state pour le builder
const [workout, setWorkout] = useState<WorkoutFormData>({
  name: '',
  description: '',
  exercises: [],
});

// Ajouter exercice
const addExercise = (exercise: Exercise) => {
  setWorkout(prev => ({
    ...prev,
    exercises: [...prev.exercises, {
      exerciseId: exercise.id,
      exercise,
      order: prev.exercises.length + 1,
      targetSets: 3,
      targetReps: 10,
      targetWeight: null,
      restBetweenSets: 90,
      restAfterExercise: 120,
    }],
  }));
};
```

### Drag and Drop
RecommandÃ©: `@hello-pangea/dnd` (fork maintenu de react-beautiful-dnd)
```tsx
import { DragDropContext, Droppable, Draggable } from '@hello-pangea/dnd';
```

### Components Shadcn & Custom
**DÃ©jÃ  installÃ©s:** Card, Input, Textarea, Button, Dialog, Sonner (toasts)
**Composants custom existants:**
- `NumberInput` (Story 1.5) - steppers +/- pour sets, reps, poids, repos

**Ã€ installer:**
```bash
npm install @hello-pangea/dnd  # Pour drag & drop
```

## Testing
- Tester crÃ©ation d'un nouveau workout
- Tester ajout d'exercices depuis le sÃ©lecteur
- Tester modification des paramÃ¨tres d'un exercice
- Tester rÃ©organisation par drag & drop
- Tester suppression d'un exercice
- Tester sauvegarde et redirection
- Tester Ã©dition d'un workout existant (prÃ©-remplissage)

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-17 | 0.1 | Initial story creation | PO Sarah |
