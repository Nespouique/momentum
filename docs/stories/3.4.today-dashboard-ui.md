# Story 3.4: Today Dashboard - UI

## Status: Draft

## Story
**As a** user,
**I want** a clean daily dashboard showing my tasks and progress,
**so that** I can quickly see what's left to do and log my activities.

## Acceptance Criteria
1. Page `/` (home) = Dashboard Today (landing page par dÃ©faut)
2. Header avec date du jour et salutation personnalisÃ©e
3. Composant StreakBadge affichÃ© prominemment (ex: "ðŸ”¥ 12 days")
4. Composant DailyProgressBar avec pourcentage de progression global
5. Section "TO DO" : items non complÃ©tÃ©s en haut (composants TrackableCard)
6. Section "COMPLETED" : items faits en bas (visuellement distincts, grayed out)
7. Pour items boolean : checkbox cliquable pour toggle done (optimistic update)
8. Pour items number/duration : tap ouvre input rapide inline avec validation
9. Item "workout" : affiche nombre de sessions du jour (0/1), tap navigue vers `/workouts`
10. Quick action "Start a Workout" bien visible en haut
11. Mise Ã  jour temps rÃ©el avec optimistic updates et React Query invalidation
12. Si aucun trackable configurÃ© : prompt vers `/settings/trackables`

## Tasks / Subtasks
- [ ] CrÃ©er page dashboard (AC: 1)
  - [ ] `app/(app)/page.tsx` ou `app/(app)/dashboard/page.tsx`
  - [ ] Fetch entries du jour avec React Query
  - [ ] Layout responsive
- [ ] CrÃ©er header dashboard (AC: 2)
  - [ ] Afficher date formatÃ©e (ex: "Today, Jan 17")
  - [ ] Salutation basÃ©e sur l'heure (Good morning/afternoon/evening)
  - [ ] Nom de l'utilisateur
- [ ] CrÃ©er composant StreakBadge (AC: 3)
  - [ ] Afficher icÃ´ne flamme + nombre de jours
  - [ ] Fetch streak global depuis API
  - [ ] Animation subtile si nouveau record
- [ ] CrÃ©er composant DailyProgressBar (AC: 4)
  - [ ] Calculer % (completed / total trackables actifs)
  - [ ] Barre de progression visuelle
  - [ ] Afficher "X of Y completed"
- [ ] Section TO DO (AC: 5)
  - [ ] Filtrer trackables non complÃ©tÃ©s
  - [ ] Mapper vers composants TrackableCard
  - [ ] Ordre basÃ© sur prioritÃ©/ordre configurÃ©
- [ ] Section COMPLETED (AC: 6)
  - [ ] Filtrer trackables complÃ©tÃ©s
  - [ ] Style grayed out / opacity rÃ©duite
  - [ ] Permettre de "unfaire" (re-toggle)
- [ ] TrackableCard boolean (AC: 7)
  - [ ] Checkbox cliquable
  - [ ] Optimistic update immÃ©diat
  - [ ] POST entry en background
  - [ ] Rollback si erreur
- [ ] TrackableCard number/duration (AC: 8)
  - [ ] Tap affiche input inline ou modal
  - [ ] Input numÃ©rique avec unitÃ©
  - [ ] Bouton valider
  - [ ] Afficher valeur actuelle si dÃ©jÃ  saisie
- [ ] TrackableCard workout (AC: 9)
  - [ ] Afficher "X sessions today"
  - [ ] Tap navigue vers /workouts
  - [ ] Non Ã©ditable directement
- [ ] Quick action workout (AC: 10)
  - [ ] CTA "Start a Workout" en haut du dashboard
  - [ ] Navigue vers /workouts
  - [ ] Style prominent
- [ ] Optimistic updates (AC: 11)
  - [ ] Utiliser React Query mutation
  - [ ] Update cache immÃ©diatement
  - [ ] Revert si erreur serveur
- [ ] Empty state (AC: 12)
  - [ ] DÃ©tecter si aucun trackable actif
  - [ ] Afficher message et bouton vers config
  - [ ] "Set up your habits to get started"

## Dev Notes

### Dashboard Layout
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â˜°  Today, Jan 17          ðŸ””  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚   Good morning, Elliot          â”‚
â”‚   ðŸ”¥ 12 days streak             â”‚
â”‚                                 â”‚
â”‚   â–“â–“â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘  67%            â”‚
â”‚   4 of 6 completed              â”‚
â”‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ðŸ’ª START A WORKOUT     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  TO DO                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ðŸ§˜ Yoga            [ ]  â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ ðŸ‘Ÿ Steps       [8,240]  â”‚   â”‚
â”‚  â”‚              / 10,000   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ ðŸ’ª Workout    0/1   â†’   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  COMPLETED âœ“                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ðŸ“– Reading    30 min âœ“  â”‚   â”‚
â”‚  â”‚ ðŸ§  Meditation 15 min âœ“  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ðŸ     ðŸ’ª    ðŸ“ˆ    ðŸ‘¤          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### StreakBadge Component
```tsx
interface StreakBadgeProps {
  count: number;
  isRecord?: boolean;
  atRisk?: boolean;
}

// Variants
// default: ðŸ”¥ 12 days
// celebrating: animation pulse + "New record!"
// at-risk: orange color + "Don't break it!"
```

### DailyProgressBar Component
```tsx
interface DailyProgressBarProps {
  completed: number;
  total: number;
  showLabel?: boolean;
}
```

### TrackableCard Component
```tsx
interface TrackableCardProps {
  trackable: TrackableItem;
  entry?: DailyEntry;
  goal?: TrackableGoal;
  onToggle?: () => void; // boolean
  onValueChange?: (value: number) => void; // number/duration
  onClick?: () => void; // workout
}
```

### Optimistic Update Pattern
```typescript
const toggleTrackable = useMutation({
  mutationFn: (data) => api.post('/tracking/entries', data),
  onMutate: async (newEntry) => {
    // Cancel outgoing refetches
    await queryClient.cancelQueries(['tracking', date]);

    // Snapshot previous value
    const previousData = queryClient.getQueryData(['tracking', date]);

    // Optimistically update
    queryClient.setQueryData(['tracking', date], (old) => ({
      ...old,
      entries: [...old.entries, newEntry],
    }));

    return { previousData };
  },
  onError: (err, newEntry, context) => {
    // Rollback on error
    queryClient.setQueryData(['tracking', date], context.previousData);
    toast.error('Failed to save');
  },
  onSettled: () => {
    queryClient.invalidateQueries(['tracking', date]);
    queryClient.invalidateQueries(['streaks']);
  },
});
```

### Time-based Greeting
```typescript
const getGreeting = () => {
  const hour = new Date().getHours();
  if (hour < 12) return 'Good morning';
  if (hour < 18) return 'Good afternoon';
  return 'Good evening';
};
```

### Components Shadcn
- Card
- Checkbox
- Progress
- Button
- Input (pour number entry)
- Badge

## Testing
- Tester affichage correct des trackables par section
- Tester toggle boolean met Ã  jour immÃ©diatement
- Tester saisie valeur number/duration
- Tester tap workout navigue vers /workouts
- Tester streak s'affiche correctement
- Tester progress bar se met Ã  jour
- Tester empty state si aucun trackable
- Tester rollback si erreur serveur

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-17 | 0.1 | Initial story creation | PO Sarah |
