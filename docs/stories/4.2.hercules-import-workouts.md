# Story 4.2: Import des Workouts (Programmes) Hercules

## User Story

**As a** user migrating from Hercules,
**I want** my workout programs imported into Momentum,
**So that** I can use the same training structure and import my history.

## Background

Cette story fait partie de l'Epic 4: Migration Hercules → Momentum.
Dépend de : Story 4.1 (mapping des exercices)

## Scope

- **5 programmes** (sessions) à créer
- **21 exercices** dans les programmes (session_exercises)
- Gestion des **supersets** (id_superset)

## Acceptance Criteria

1. Script CLI exécutable via `npx ts-node scripts/hercules-import-workouts.ts`
2. Création des 5 Workouts avec leur nom
3. Création des WorkoutItems (exercices ou supersets)
4. Création des WorkoutItemExercises avec référence aux exercices Momentum
5. Création des WorkoutSets avec targetReps et targetWeight parsés
6. Exercices d'étirement ignorés (Étirements pecs, Étirement table épaules)
7. Génération d'un fichier de mapping `hercules-session-id → momentum-workout-id`
8. Script idempotent

## Programmes à créer

### 1. Bras (6 exercices, 2 supersets)

| Pos | Exercice | Sets | Reps | Load | Superset |
|-----|----------|------|------|------|----------|
| 0 | Curl pupitre barre | 5 | 20-15-12-12-12 | 10-12.5-15-15-15 | SS:33 |
| 1 | Dips à la machine | 5 | 20-15-12-12-12 | 40-50-60-60-60 | SS:33 |
| 2 | Curl incliné | 5 | 20-15-12-12-15 | 10-12-14-14-12 | - |
| 3 | Curl concentré | 4 | 15-15-15-15 | 12-12-12-12 | SS:34 |
| 4 | Triceps poulie haute | 4 | 20-20-20-20 | 15-15-15-15 | SS:34 |
| 5 | Curl marteau | 3 | 12-12-12 | 12-12-12 | - |

### 2. Fessiers (3 exercices)

| Pos | Exercice | Sets | Reps | Load |
|-----|----------|------|------|------|
| 0 | Hip thrust | 5 | 15-15-12-12-12 | 25-45-65-65-65 |
| 1 | Split squat | 4 | 10-10-10-10 | 10-12-14-12 |
| 2 | Leg curl | 4 | 15-12-10-10 | 40-50-60-60 |

### 3. Pecs (4 exercices)

| Pos | Exercice | Sets | Reps | Load |
|-----|----------|------|------|------|
| 0 | Développé couché barre | 5 | 15-12-10-8-8 | 15-22.5-27.5-30-30 |
| 1 | Chest press | 5 | 20-15-12-10-12 | 25-30-35-40-35 |
| 2 | Declined chest press | 4 | 20-15-12-15 | 20-30-40-30 |
| 3 | Cable fly | 4 | 15-10-10-12 | 7.5-12.5-12.5-10 |

### 4. Séance dos (4 exercices) → "Dos"

| Pos | Exercice | Sets | Reps | Load |
|-----|----------|------|------|------|
| 0 | Tirage vertical | 5 | 20-15-12-12-15 | 30-40-50-50-40 |
| 1 | Tirage horizontal | 4 | 20-15-12-12 | 20-30-40-40 |
| 2 | Tirage sous horizontal | 4 | 20-15-12-15 | 20-30-40-30 |
| 3 | Tractions | 3 | 12-12-12 | 0-0-0 |

### 5. Épaules (4 exercices)

| Pos | Exercice | Sets | Reps | Load |
|-----|----------|------|------|------|
| 0 | Rotation externe épaule | 3 | 20-20-20 | 2.5-2.5-2.5 |
| 1 | Développé militaire à la machine | 4 | 20-15-12-12 | 10-20-30-30 |
| 2 | Oiseau à la poulie | 4 | 20-20-20-20 | 2.5-3.25-3.25-3.25 |
| 3 | Élévations latérales | 3 | 15-15-15 | 12-12-12 |

## Data Transformation

### Hercules → Momentum

```
sessions                    → Workout
├── name ──────────────────► name
└── description ───────────► description

session_exercises           → WorkoutItem + WorkoutItemExercise + WorkoutSet
├── position ──────────────► WorkoutItem.position
├── id_superset ───────────► WorkoutItem.type ('exercise' | 'superset')
├── id_exercise ───────────► WorkoutItemExercise.exerciseId (via mapping)
├── nb_reps "20-15-12" ────► WorkoutSet[].targetReps (parsed)
├── loads "30-40-50" ──────► WorkoutSet[].targetWeight (parsed)
├── rest_time_between_sets ► WorkoutItemExercise.restBetweenSets
└── rest_time_end_of_exercise► WorkoutItem.restAfter
```

### Gestion des supersets

Les exercices avec le même `id_superset > 0` sont groupés dans un seul `WorkoutItem` de type `superset`.

```typescript
// Pseudo-code
const exercisesBySuperset = groupBy(sessionExercises, se => se.id_superset);

for (const [supersetId, exercises] of exercisesBySuperset) {
  if (supersetId === 0) {
    // Exercices individuels
    for (const ex of exercises) {
      createWorkoutItem({ type: 'exercise', ... });
    }
  } else {
    // Superset
    createWorkoutItem({
      type: 'superset',
      rounds: exercises[0].nb_sets,
      exercises: exercises.map(ex => ...)
    });
  }
}
```

## Technical Notes

### Parsing des valeurs

```typescript
function parseHerculesArray(str: string | null): number[] {
  if (!str) return [];
  return str.split('-').map(v => parseFloat(v)).filter(v => !isNaN(v));
}

// rest_time_between_sets peut être "120" ou "120-120-120"
function parseRestTime(str: string | null): number {
  if (!str) return 60; // default
  const parts = str.split('-');
  return parseInt(parts[0]) || 60;
}
```

### Fichier de sortie

```json
// scripts/hercules-workout-mapping.json
{
  "4611686018427388000_Bras": { "momentumId": "uuid-xxx", "name": "Bras" },
  "4611686018427388000_Pecs": { "momentumId": "uuid-yyy", "name": "Pecs" },
  ...
}
```

## Definition of Done

- [x] Script créé et testé
- [x] 5 Workouts créés en production
- [x] WorkoutItems, WorkoutItemExercises, WorkoutSets créés
- [x] Supersets correctement gérés
- [x] Fichier de mapping JSON généré
- [x] Exercices d'étirement ignorés

## Dependencies

- Story 4.1 (mapping exercices)

## Story Points

3 (Medium)

---

## Dev Agent Record

### Status: Completed

### Agent Model Used
Claude Opus 4.5

### File List
| File | Action |
|------|--------|
| `scripts/hercules-import-workouts.ts` | Created |
| `scripts/hercules-workout-mapping.json` | Generated |

### Completion Notes
- Script testé sur BDD dev (localhost:5432) avec succès
- 5 Workouts créés: Bras, Fessiers, Pecs, Dos, Épaules
- 19 WorkoutItems au total (incluant 2 supersets dans Bras)
- 21 WorkoutItemExercises créés
- 87 WorkoutSets créés
- Session "Épaules rééducation" ignorée
- Exercice orphelin (ID 55) dans Fessiers ignoré automatiquement
- Idempotence vérifiée: 0 doublons au relancement

### Production Results
```
Bras:      4 items, 6 exercices, 26 sets
Fessiers:  3 items, 3 exercices, 13 sets
Pecs:      4 items, 4 exercices, 18 sets
Dos:       4 items, 4 exercices, 16 sets
Épaules:   4 items, 4 exercices, 14 sets
```

### Change Log
| Date | Change |
|------|--------|
| 2026-02-04 | Script créé et testé sur dev |
| 2026-02-04 | Exécuté sur prod: 5 créés, 1 ignoré |
