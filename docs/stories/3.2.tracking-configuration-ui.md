# Story 3.2: Tracking Configuration - UI

## Status: Done

## Story
**As a** user,
**I want** to configure what I track and set my goals,
**so that** the app adapts to my personal habits and objectives.

## Acceptance Criteria
1. Page `/settings/trackables` pour configuration des trackables
2. Liste des items trackÃ©s avec toggle on/off pour chaque
3. Bouton "Ajouter un Ã©lÃ©ment" pour crÃ©er un nouveau trackable
4. Formulaire TrackableForm : nom, icÃ´ne (sÃ©lecteur Lucide icons), couleur (color picker), type (checkbox/nombre/durÃ©e), unitÃ© si nombre/durÃ©e
5. Pour chaque item actif : configuration de l'objectif via modal/drawer
6. Options d'objectif : frÃ©quence (quotidien/hebdomadaire/mensuel) + valeur cible
7. PossibilitÃ© de rÃ©ordonner les items (drag & drop, affecte l'ordre sur le dashboard)
8. PossibilitÃ© de supprimer un trackable personnalisÃ© (avec confirmation Dialog)
9. Le trackable "workout" est visible mais non modifiable/supprimable

## Tasks / Subtasks
- [x] CrÃ©er page configuration (AC: 1, 2)
  - [x] `app/(app)/profile/trackables/page.tsx`
  - [x] Fetch trackables (fetch direct, pas React Query)
  - [x] Liste avec Switch toggle pour isActive
  - [x] Distinguer trackables actifs/inactifs visuellement (opacity-60)
  - [x] Sections sÃ©parÃ©es : systÃ¨me (Health Connect) et personnalisÃ©s
- [x] Bouton ajouter (AC: 3)
  - [x] Bouton "+" flottant en bas Ã  droite
  - [x] Ouvre Sheet CreateTrackableModal
- [x] CrÃ©er TrackableForm (AC: 4)
  - [x] Input nom avec suggestions IA au blur
  - [x] SÃ©lecteur d'icÃ´ne par texte (lucide.dev) + suggestions IA cliquables
  - [x] Color picker (presets + IA)
  - [x] Select type: BoolÃ©en / Nombre / DurÃ©e
  - [x] Input unitÃ© (conditionnel si nombre/durÃ©e)
  - [x] Validation avec Zod
  - [x] AperÃ§u live de la carte en haut du formulaire
- [x] Configuration objectif (AC: 5, 6)
  - [x] Objectif obligatoire Ã  la crÃ©ation (min targetValue: 1)
  - [x] Select frÃ©quence + valeur cible dans le formulaire de crÃ©ation
  - [x] GoalEditModal pour modifier l'objectif des trackables systÃ¨me
  - [x] Clic sur carte custom â†’ rÃ©ouvre le Sheet en mode Ã©dition
- [x] RÃ©ordonner items (AC: 7)
  - [x] Drag handles sur chaque item custom
  - [x] @dnd-kit/core + @dnd-kit/sortable (directement, mÃªme pattern que rÃ©ordonnancement exercices)
  - [x] Persister l'ordre via PUT /trackables/reorder
- [x] Supprimer trackable (AC: 8)
  - [x] Bouton trash sur items personnalisÃ©s
  - [x] ConfirmDeleteDialog (mÃªme composant que suppression exercice)
  - [x] DELETE /trackables/:id
- [x] Trackable systÃ¨me protÃ©gÃ© (AC: 9)
  - [x] Section sÃ©parÃ©e "Trackables systÃ¨me (Health Connect)"
  - [x] Pas de bouton trash ni drag handle
  - [x] Toggle actif visible, clic ouvre GoalEditModal

## Dev Notes

### Page Layout
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† Settings                     â”‚
â”‚  Tracking Configuration         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â‰¡ ðŸ’ª Workout  [System]  â”‚   â”‚
â”‚  â”‚   Goal: 4Ã— per week  ðŸ”’ â”‚   â”‚
â”‚  â”‚              [ON/OFF]   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ â‰¡ ðŸ§˜ Yoga               â”‚   â”‚
â”‚  â”‚   Goal: daily      âš™   â”‚   â”‚
â”‚  â”‚              [ON/OFF]   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ â‰¡ ðŸ‘Ÿ Pas                â”‚   â”‚
â”‚  â”‚   Goal: 10,000/day âš™   â”‚   â”‚
â”‚  â”‚              [ON/OFF]   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ â‰¡ ðŸ“– Lecture (off)      â”‚   â”‚
â”‚  â”‚   No goal set      âš™   â”‚   â”‚
â”‚  â”‚              [ON/OFF]   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  + Add New Trackable    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Icon Selector
Utiliser une liste des icÃ´nes Lucide courantes:
```typescript
const commonIcons = [
  'heart', 'star', 'zap', 'target', 'trophy',
  'book', 'code', 'coffee', 'music', 'palette',
  'brain', 'dumbbell', 'footprints', 'moon', 'sun',
  'droplet', 'flame', 'leaf', 'pill', 'bed',
];
```

### Color Picker
Options prÃ©dÃ©finies + custom:
```typescript
const presetColors = [
  '#EF4444', // red
  '#F59E0B', // amber
  '#22C55E', // green
  '#3B82F6', // blue
  '#8B5CF6', // purple
  '#EC4899', // pink
  '#14B8A6', // teal
  '#6B7280', // gray
];
```

### TrackableForm Schema
```typescript
const trackableFormSchema = z.object({
  name: z.string().min(2).max(50),
  icon: z.string(),
  color: z.string().regex(/^#[0-9A-Fa-f]{6}$/),
  trackingType: z.enum(['boolean', 'number', 'duration']),
  unit: z.string().max(20).optional(),
});
```

### Goal Configuration Modal
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Configure Goal                 â”‚
â”‚  Yoga                      âœ•   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚  Frequency                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Daily              â–¼    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â”‚  Target                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 5                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  times per week                 â”‚
â”‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      [Cancel]    [Save]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Components Shadcn & Custom
- Switch (toggle on/off)
- Dialog (forms, confirmation)
- Select (type, frequency)
- Input
- Button
- Card
- MenuItem (composant custom pour chaque trackable dans la liste - crÃ©Ã© en 1.5)
- MenuSection (composant custom pour grouper les trackables - crÃ©Ã© en 1.5)
- NumberInput (composant custom pour la valeur cible des goals - crÃ©Ã© en 1.5)

### React Query Mutations
```typescript
const updateTrackable = useMutation({
  mutationFn: (data) => api.put(`/trackables/${id}`, data),
  onSuccess: () => queryClient.invalidateQueries(['trackables']),
});

const createGoal = useMutation({
  mutationFn: ({ trackableId, ...data }) =>
    api.post(`/trackables/${trackableId}/goals`, data),
  onSuccess: () => queryClient.invalidateQueries(['trackables']),
});
```

## Testing
- Tester toggle on/off met Ã  jour isActive
- Tester crÃ©ation d'un nouveau trackable
- Tester sÃ©lection d'icÃ´ne et couleur
- Tester configuration d'un goal
- Tester modification d'un goal existant
- Tester drag & drop pour rÃ©ordonner
- Tester suppression avec confirmation
- VÃ©rifier que workout ne peut pas Ãªtre modifiÃ©/supprimÃ©

## Completion Notes
- Route: `/profile/trackables` (not `/settings/trackables` as originally planned)
- Icon selector: text input with live preview instead of grid of common icons
- AI suggestions via OpenAI gpt-4o-mini: 5 validated icon suggestions + color on name blur
- @lucide/lab installed for extended icon library (flower-lotus, etc.)
- `scripts/generate-icon-list.mjs` generates valid icon names from npm packages at postinstall
- CreateTrackableModal supports both create and edit mode (dual-purpose)
- Goal is mandatory (not optional) â€” schema enforces targetValue >= 1
- DnD uses @dnd-kit directly (not the sortable.tsx wrapper) for consistency with session exercise reorder
- Custom trackable duration display: raw value + user unit (no auto-conversion to h/min)

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-17 | 0.1 | Initial story creation | PO Sarah |
| 2026-02-14 | 1.0 | Implementation complete | Dev |
