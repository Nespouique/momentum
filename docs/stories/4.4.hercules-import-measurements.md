# Story 4.4: Import des mensurations Hercules

## User Story

**As a** user migrating from Hercules,
**I want** my body measurements imported into Momentum,
**So that** I can track my physical progress with historical data.

## Background

Cette story fait partie de l'Epic 4: Migration Hercules → Momentum.

## Scope

- **2 mensurations** à importer (après 28/02/2024)
- **0 poids** (aucun enregistrement après la date de coupure)

## Données à importer

| Date | Chest | Waist | Hips | Autres |
|------|-------|-------|------|--------|
| 28/04/2024 | 108 | 80 | 98 | ... |
| 16/06/2024 | 110 | 82 | 97 | ... |

## Acceptance Criteria

1. Script CLI exécutable via `npx ts-node scripts/hercules-import-measurements.ts`
2. Création des Measurement avec toutes les valeurs disponibles
3. Conversion des timestamps Hercules (ms) → Date
4. Mapping correct des champs (snake_case → camelCase)
5. Vérification des doublons par date avant insertion
6. Log des mesures importées

## Data Transformation

### Hercules → Momentum

| Hercules | Momentum |
|----------|----------|
| `date` (timestamp ms) | `date` (Date) |
| `neck` | `neck` |
| `shoulders` | `shoulders` |
| `chest` | `chest` |
| `biceps_left` | `bicepsLeft` |
| `biceps_right` | `bicepsRight` |
| `forearm_left` | `forearmLeft` |
| `forearm_right` | `forearmRight` |
| `wrist_left` | `wristLeft` |
| `wrist_right` | `wristRight` |
| `waist` | `waist` |
| `hips` | `hips` |
| `thigh_left` | `thighLeft` |
| `thigh_right` | `thighRight` |
| `calf_left` | `calfLeft` |
| `calf_right` | `calfRight` |
| `ankle_left` | `ankleLeft` |
| `ankle_right` | `ankleRight` |

Note : Les valeurs à 0 dans Hercules seront converties en `null` dans Momentum.

## Technical Notes

```typescript
// scripts/hercules-import-measurements.ts

async function importMeasurements() {
  const herculesMeasurements = await getHerculesMeasurements();

  for (const m of herculesMeasurements) {
    const date = new Date(m.date);

    // Vérifier si existe déjà
    const existing = await prisma.measurement.findFirst({
      where: { userId, date }
    });

    if (existing) {
      console.log(`Measurement ${date.toLocaleDateString()} already exists, skipping`);
      continue;
    }

    await prisma.measurement.create({
      data: {
        userId,
        date,
        neck: m.neck || null,
        shoulders: m.shoulders || null,
        chest: m.chest || null,
        bicepsLeft: m.biceps_left || null,
        bicepsRight: m.biceps_right || null,
        forearmLeft: m.forearm_left || null,
        forearmRight: m.forearm_right || null,
        wristLeft: m.wrist_left || null,
        wristRight: m.wrist_right || null,
        waist: m.waist || null,
        hips: m.hips || null,
        thighLeft: m.thigh_left || null,
        thighRight: m.thigh_right || null,
        calfLeft: m.calf_left || null,
        calfRight: m.calf_right || null,
        ankleLeft: m.ankle_left || null,
        ankleRight: m.ankle_right || null,
        notes: 'Importé depuis Hercules',
      }
    });

    console.log(`Created measurement for ${date.toLocaleDateString()}`);
  }
}
```

## Definition of Done

- [x] Script créé et testé
- [x] 2 mensurations importées en production
- [x] Valeurs nulles correctement gérées
- [x] Log de l'import

## Dependencies

- Aucune (peut être exécuté indépendamment)

## Story Points

1 (XSmall)

---

## Dev Agent Record

### Status: Completed

### Agent Model Used
Claude Opus 4.5

### File List
| File | Action |
|------|--------|
| `scripts/hercules-import-measurements.ts` | Created |
| `scripts/check-hercules-measurements.js` | Created (debug) |

### Completion Notes
- Script testé sur BDD dev et prod
- 2 mensurations déjà présentes (importées précédemment)
- Idempotence vérifiée: 0 doublons
- Dates importées: 28/04/2024, 16/06/2024
- 18 champs de mensuration par enregistrement
- Valeurs à 0 converties en null

### Production Results
```
Mensurations: 2 (déjà existantes)
- 28/04/2024: Poitrine 108cm, Taille 80cm, Hanches 98cm
- 16/06/2024: Poitrine 110cm, Taille 82cm, Hanches 97cm
```

### Change Log
| Date | Change |
|------|--------|
| 2026-02-04 | Script créé et testé sur dev |
| 2026-02-04 | Exécuté sur prod: 2 existantes, 0 créées |
