# Story 1.5: User Profile Management

## Status: Draft

## Story
**As a** user,
**I want** to view and edit my profile information,
**so that** I can personalize my experience and track my baseline stats.

## Acceptance Criteria
1. ModÃ¨le `User` Ã©tendu avec champs profil (age, height, goal description)
2. Endpoints API : `GET /profile`, `PATCH /profile`, `PUT /profile/password`
3. Page `/profile` (Profile Hub) affichant les informations du profil
4. Formulaire d'Ã©dition du profil avec validation (React Hook Form + Zod)
5. FonctionnalitÃ© de changement de mot de passe (formulaire sÃ©parÃ©)
6. Feedback visuel lors de la sauvegarde (loading, success Toast, error)
7. Navigation vers profil depuis bottom nav (icÃ´ne User)

## Tasks / Subtasks
- [ ] Ã‰tendre modÃ¨le User (AC: 1)
  - [ ] Ajouter migration Prisma pour nouveaux champs
  - [ ] Champs: age (Int?), height (Float?), goalDescription (String?)
  - [ ] GÃ©nÃ©rer Prisma Client
- [ ] CrÃ©er endpoints profile (AC: 2)
  - [ ] GET /profile - retourner profil utilisateur courant
  - [ ] PATCH /profile - mettre Ã  jour les champs profil
  - [ ] PUT /profile/password - changer le mot de passe
  - [ ] Validation avec Zod pour chaque endpoint
- [ ] CrÃ©er page Profile Hub (AC: 3)
  - [ ] CrÃ©er `app/(app)/profile/page.tsx`
  - [ ] Afficher avatar placeholder, nom, email
  - [ ] Liste de liens: Mensurations, Tracking Config, Edit Profile, Settings
  - [ ] Bouton Logout
- [ ] CrÃ©er formulaire Ã©dition profil (AC: 4)
  - [ ] CrÃ©er `app/(app)/profile/edit/page.tsx` ou modal
  - [ ] Champs: name, age, height, goalDescription
  - [ ] Validation avec Zod
  - [ ] PrÃ©-remplir avec donnÃ©es actuelles
- [ ] CrÃ©er formulaire changement password (AC: 5)
  - [ ] CrÃ©er section ou page dÃ©diÃ©e
  - [ ] Champs: currentPassword, newPassword, confirmNewPassword
  - [ ] Validation: nouveau password diffÃ©rent, confirmation match
- [ ] ImplÃ©menter feedback visuel (AC: 6)
  - [ ] Installer composant Toast de Shadcn
  - [ ] Afficher loading state pendant sauvegarde
  - [ ] Toast success aprÃ¨s sauvegarde rÃ©ussie
  - [ ] Afficher erreurs inline si Ã©chec
- [ ] Ajouter navigation (AC: 7)
  - [ ] Ajouter icÃ´ne User dans bottom nav
  - [ ] Route active highlighting

## Dev Notes

### Prisma Migration
```prisma
model User {
  id              String   @id @default(uuid())
  email           String   @unique
  passwordHash    String   @map("password_hash")
  name            String
  age             Int?
  height          Float?   // en cm
  goalDescription String?  @map("goal_description")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  @@map("users")
}
```

### API Endpoints
```typescript
// GET /profile
Response: {
  id: string;
  email: string;
  name: string;
  age: number | null;
  height: number | null;
  goalDescription: string | null;
}

// PATCH /profile
Request: {
  name?: string;
  age?: number;
  height?: number;
  goalDescription?: string;
}

// PUT /profile/password
Request: {
  currentPassword: string;
  newPassword: string;
}
```

### Zod Schemas
```typescript
const updateProfileSchema = z.object({
  name: z.string().min(2).optional(),
  age: z.number().min(10).max(120).optional(),
  height: z.number().min(50).max(300).optional(),
  goalDescription: z.string().max(500).optional(),
});

const changePasswordSchema = z.object({
  currentPassword: z.string().min(1),
  newPassword: z.string().min(8),
});
```

### Profile Hub Layout (Mobile)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Profile               âš™   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         [Avatar]            â”‚
â”‚         Elliot              â”‚
â”‚    elliot@example.com       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ Measurements         â†’   â”‚
â”‚ ğŸ“Š Tracking Config      â†’   â”‚
â”‚ ğŸ‘¤ Edit Profile         â†’   â”‚
â”‚ âš™  Settings             â†’   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸšª Logout                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ     ğŸ’ª    ğŸ“ˆ    ğŸ‘¤      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Components Shadcn Ã  installer
- Toast (pour notifications)
- Avatar
- Card
- Button
- Input
- Form (React Hook Form integration)

## Testing
- Tester GET /profile retourne les donnÃ©es utilisateur
- Tester PATCH /profile met Ã  jour les champs
- Tester PUT /profile/password avec bon current password
- Tester PUT /profile/password avec mauvais current password â†’ erreur
- Tester que le Toast s'affiche aprÃ¨s sauvegarde

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-17 | 0.1 | Initial story creation | PO Sarah |
