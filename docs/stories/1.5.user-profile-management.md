# Story 1.5: User Profile Management

## Status: Ready for Review

## Story
**As a** user,
**I want** to view and edit my profile information,
**so that** I can personalize my experience and track my baseline stats.

## Acceptance Criteria
1. ModÃ¨le `User` Ã©tendu avec champs profil (birthDate, height, goal description)
2. Endpoints API : `GET /profile`, `PATCH /profile`, `PUT /profile/password`
3. Page `/profile` (Profile Hub) affichant les informations du profil
4. Formulaire d'Ã©dition du profil avec validation (React Hook Form + Zod)
5. FonctionnalitÃ© de changement de mot de passe (formulaire sÃ©parÃ©)
6. Feedback visuel lors de la sauvegarde (loading, success Toast, error)
7. Navigation vers profil depuis bottom nav (icÃ´ne User)

## Tasks / Subtasks
- [x] Ã‰tendre modÃ¨le User (AC: 1)
  - [x] Ajouter migration Prisma pour nouveaux champs
  - [x] Champs: birthDate (DateTime?), height (Float?), goalDescription (String?)
  - [x] GÃ©nÃ©rer Prisma Client
- [x] CrÃ©er endpoints profile (AC: 2)
  - [x] GET /profile - retourner profil utilisateur courant
  - [x] PATCH /profile - mettre Ã  jour les champs profil
  - [x] PUT /profile/password - changer le mot de passe
  - [x] Validation avec Zod pour chaque endpoint
- [x] CrÃ©er page Profile Hub (AC: 3)
  - [x] CrÃ©er `app/(app)/profile/page.tsx`
  - [x] Afficher avatar placeholder, nom, email
  - [x] Liste de liens: Mensurations, Tracking Config, Edit Profile, Settings
  - [x] Bouton Logout
- [x] CrÃ©er formulaire Ã©dition profil (AC: 4)
  - [x] CrÃ©er `app/(app)/profile/edit/page.tsx`
  - [x] Champs: name, birthDate (date picker), height, goalDescription
  - [x] Validation avec Zod
  - [x] PrÃ©-remplir avec donnÃ©es actuelles
- [x] CrÃ©er formulaire changement password (AC: 5)
  - [x] Section dans la page Edit Profile
  - [x] Champs: currentPassword, newPassword, confirmNewPassword
  - [x] Validation: nouveau password diffÃ©rent, confirmation match
- [x] ImplÃ©menter feedback visuel (AC: 6)
  - [x] Installer composant Sonner pour notifications
  - [x] Afficher loading state pendant sauvegarde
  - [x] Toast success aprÃ¨s sauvegarde rÃ©ussie
  - [x] Afficher erreurs inline si Ã©chec
- [x] Ajouter navigation (AC: 7)
  - [x] IcÃ´ne User dans bottom nav (dÃ©jÃ  prÃ©sent depuis Story 1.3)
  - [x] Route active highlighting

## Dev Notes

### Prisma Migration
```prisma
model User {
  id              String    @id @default(uuid())
  email           String    @unique
  passwordHash    String    @map("password_hash")
  name            String
  birthDate       DateTime? @map("birth_date") @db.Date
  height          Float?    // en cm
  goalDescription String?   @map("goal_description")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  @@map("users")
}
```

### API Endpoints
```typescript
// GET /profile
Response: {
  id: string;
  email: string;
  name: string;
  birthDate: string | null;  // ISO date string YYYY-MM-DD
  height: number | null;
  goalDescription: string | null;
}

// PATCH /profile
Request: {
  name?: string;
  birthDate?: string | null;  // ISO date string YYYY-MM-DD
  height?: number;
  goalDescription?: string;
}

// PUT /profile/password
Request: {
  currentPassword: string;
  newPassword: string;
}
```

### Zod Schemas
```typescript
const updateProfileSchema = z.object({
  name: z.string().min(2).optional(),
  birthDate: z.string().optional().nullable(),  // ISO date string YYYY-MM-DD
  height: z.number().min(50).max(300).optional(),
  goalDescription: z.string().max(500).optional(),
});

const changePasswordSchema = z.object({
  currentPassword: z.string().min(1),
  newPassword: z.string().min(8),
});
```

### Profile Hub Layout (Mobile)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Profile               âš™   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         [Avatar]            â”‚
â”‚         Elliot              â”‚
â”‚    elliot@example.com       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ Measurements         â†’   â”‚
â”‚ ğŸ“Š Tracking Config      â†’   â”‚
â”‚ ğŸ‘¤ Edit Profile         â†’   â”‚
â”‚ âš™  Settings             â†’   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸšª Logout                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ     ğŸ’ª    ğŸ“ˆ    ğŸ‘¤      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Components Shadcn Ã  installer
- Toast (pour notifications)
- Avatar
- Card
- Button
- Input
- Form (React Hook Form integration)

## Testing
- Tester GET /profile retourne les donnÃ©es utilisateur
- Tester PATCH /profile met Ã  jour les champs
- Tester PUT /profile/password avec bon current password
- Tester PUT /profile/password avec mauvais current password â†’ erreur
- Tester que le Toast s'affiche aprÃ¨s sauvegarde

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-17 | 0.1 | Initial story creation | PO Sarah |
| 2026-01-18 | 1.0 | Implementation completed | Dev James |

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5

### Debug Log References
- None

### Completion Notes
- Extended User model with birthDate, height, goalDescription fields
- Prisma migration `add_profile_fields` applied, then `replace_age_with_birthdate`
- Profile API routes with Zod validation
- Profile Hub page with avatar, user info, and navigation links
- Edit Profile page with profile form + change password form
- Sonner toasts for success feedback
- Reorganized app structure with (app) route group for authenticated pages

### File List
| File | Status |
|------|--------|
| apps/api/prisma/schema.prisma | Modified |
| apps/api/prisma/migrations/20260118121505_add_profile_fields/migration.sql | Created |
| apps/api/src/schemas/profile.schema.ts | Created |
| apps/api/src/routes/profile.routes.ts | Created |
| apps/api/src/index.ts | Modified |
| apps/web/src/lib/api/profile.ts | Created |
| apps/web/src/lib/validations/profile.ts | Created |
| apps/web/src/app/(app)/layout.tsx | Created |
| apps/web/src/app/(app)/page.tsx | Created |
| apps/web/src/app/(app)/profile/page.tsx | Created |
| apps/web/src/app/(app)/profile/edit/page.tsx | Created |
| apps/web/src/components/profile/profile-nav-link.tsx | Created |
| apps/web/src/components/ui/toast.tsx | Created |
| apps/web/src/components/ui/toaster.tsx | Created |
| apps/web/src/components/ui/avatar.tsx | Created |
| apps/web/src/components/ui/separator.tsx | Created |
| apps/web/src/components/ui/sonner.tsx | Created |
| apps/web/src/components/ui/textarea.tsx | Created |
| apps/web/src/hooks/use-toast.ts | Created |
| apps/web/src/app/layout.tsx | Modified |
| apps/web/src/app/page.tsx | Deleted |
| apps/web/package.json | Modified |
