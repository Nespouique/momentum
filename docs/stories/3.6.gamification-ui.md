# Story 3.6: Gamification UI - Streaks & Progress Display

## Status: Draft

## Story
**As a** user,
**I want** to see my streaks and monthly progress visually,
**so that** I stay motivated by seeing my consistency.

## Acceptance Criteria
1. Badge streak affichÃ© sur le dashboard (ex: "ðŸ”¥ 12 jours")
2. Streak individuel visible par trackable item (icÃ´ne flamme + nombre)
3. Pour objectifs mensuels : affichage "X/Y jours ce mois" avec barre de progression
4. Couleur de la barre change selon progression (vert si on track, orange si en retard, rouge si objectif impossible)
5. Section ou modal "Mes stats" accessible depuis le dashboard
6. Stats affichÃ©es : streak actuel, meilleur streak, progression du mois par item
7. Animation subtile lors d'un nouveau record de streak
8. Style fintech : sobre, Ã©lÃ©gant, data-driven (pas de confettis ou animations enfantines)

## Tasks / Subtasks
- [ ] AmÃ©liorer StreakBadge (AC: 1)
  - [ ] Afficher sur le dashboard header
  - [ ] Format: "ðŸ”¥ 12 days" ou "ðŸ”¥ 12j"
  - [ ] Couleur accent (orange-500)
- [ ] Streak par trackable (AC: 2)
  - [ ] Ajouter streak info dans TrackableCard
  - [ ] Mini badge flamme + nombre
  - [ ] Visible sur items complÃ©tÃ©s
- [ ] Progress bars mensuels (AC: 3, 4)
  - [ ] Composant MonthlyProgress
  - [ ] Afficher "X/Y jours" avec barre
  - [ ] Logique de couleur:
    - Vert: on track ou avance
    - Orange: en retard mais rattrapable
    - Rouge: objectif impossible
- [ ] Section/Modal Stats (AC: 5, 6)
  - [ ] Bouton "View stats" sur dashboard
  - [ ] Modal ou page /stats
  - [ ] Afficher pour chaque trackable:
    - Current streak
    - Longest streak
    - This month progress
    - Average (pour number/duration)
- [ ] Animation nouveau record (AC: 7)
  - [ ] DÃ©tecter quand currentStreak > previousLongest
  - [ ] Animation pulse subtile
  - [ ] Toast "New record! ðŸŽ‰" (sobre)
  - [ ] Persister "celebrated" pour ne pas rÃ©pÃ©ter
- [ ] Style fintech (AC: 8)
  - [ ] Pas de confettis
  - [ ] Animations CSS subtiles (scale, opacity)
  - [ ] Couleurs de la palette dÃ©finie
  - [ ] Typography data-focused

## Dev Notes

### StreakBadge Enhanced
```tsx
interface StreakBadgeProps {
  count: number;
  isRecord?: boolean;
  atRisk?: boolean;
  size?: 'sm' | 'md' | 'lg';
}

// Styles
const variants = {
  default: 'bg-orange-500/20 text-orange-400',
  atRisk: 'bg-yellow-500/20 text-yellow-400 animate-pulse',
  record: 'bg-orange-500/30 text-orange-300 ring-2 ring-orange-500/50',
};
```

### MonthlyProgress Component
```tsx
interface MonthlyProgressProps {
  current: number;    // jours complÃ©tÃ©s ce mois
  target: number;     // objectif (ex: 20 jours)
  daysRemaining: number;
}

const getProgressStatus = (current: number, target: number, daysRemaining: number) => {
  const needed = target - current;

  if (current >= target) return 'completed'; // vert, objectif atteint
  if (needed <= daysRemaining) return 'on-track'; // vert, faisable
  if (needed <= daysRemaining * 1.2) return 'at-risk'; // orange, serrÃ©
  return 'impossible'; // rouge, impossible
};

// Couleurs
const progressColors = {
  completed: 'bg-green-500',
  'on-track': 'bg-green-500',
  'at-risk': 'bg-yellow-500',
  impossible: 'bg-red-500',
};
```

### Stats Modal Layout
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  My Stats                  âœ•   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚  OVERALL                        â”‚
â”‚  ðŸ”¥ Current streak: 12 days     â”‚
â”‚  ðŸ† Longest streak: 15 days     â”‚
â”‚  ðŸ“Š This month: 71%             â”‚
â”‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  BY HABIT                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ðŸ§˜ Yoga                 â”‚   â”‚
â”‚  â”‚ ðŸ”¥ 7 days  ðŸ† 21 days   â”‚   â”‚
â”‚  â”‚ Jan: 15/20 â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘  â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ ðŸ‘Ÿ Steps                â”‚   â”‚
â”‚  â”‚ ðŸ”¥ 4 days  ðŸ† 12 days   â”‚   â”‚
â”‚  â”‚ Avg: 8,543 steps        â”‚   â”‚
â”‚  â”‚ Jan: 12/31 â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘  â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ ðŸ’ª Workout              â”‚   â”‚
â”‚  â”‚ ðŸ”¥ 12 days ðŸ† 15 days   â”‚   â”‚
â”‚  â”‚ Jan: 8/16  â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Record Animation
```css
@keyframes record-pulse {
  0%, 100% {
    transform: scale(1);
    opacity: 1;
  }
  50% {
    transform: scale(1.05);
    opacity: 0.9;
  }
}

.streak-record {
  animation: record-pulse 0.6s ease-in-out;
}
```

### Record Detection Logic
```typescript
// Dans le hook useStreaks ou composant
const [hasSeenRecord, setHasSeenRecord] = useState(() => {
  return localStorage.getItem(`streak-record-${streakId}`) === 'true';
});

useEffect(() => {
  if (streak.currentStreak > streak.longestStreak && !hasSeenRecord) {
    // C'est un nouveau record!
    setIsNewRecord(true);
    toast.success('New streak record! ðŸŽ‰', { duration: 3000 });
    localStorage.setItem(`streak-record-${streakId}`, 'true');
  }
}, [streak.currentStreak, streak.longestStreak]);
```

### Data Fetching
```typescript
// hooks/useStats.ts
export function useStats() {
  return useQuery({
    queryKey: ['stats'],
    queryFn: async () => {
      const [streaks, summary] = await Promise.all([
        api.get('/streaks'),
        api.get('/tracking/summary', { params: { period: 'month' } }),
      ]);
      return { streaks: streaks.data, summary: summary.data };
    },
  });
}
```

### Projection Calculation
```typescript
// Calculer si objectif atteignable
const calculateProjection = (
  current: number,
  target: number,
  daysInMonth: number,
  currentDay: number
) => {
  const daysRemaining = daysInMonth - currentDay;
  const needed = target - current;

  if (needed <= 0) {
    return { status: 'completed', message: 'Goal achieved! ðŸŽ¯' };
  }
  if (needed <= daysRemaining) {
    return {
      status: 'on-track',
      message: `${needed} more days needed, ${daysRemaining} days left`,
    };
  }
  return {
    status: 'impossible',
    message: `Would need ${needed} days but only ${daysRemaining} left`,
  };
};
```

### Components
- Badge (Shadcn)
- Progress (Shadcn)
- Dialog (pour stats modal)
- Card
- Custom StreakBadge
- Custom MonthlyProgress

## Testing
- Tester affichage streak badge sur dashboard
- Tester streak individuel sur chaque trackable
- Tester barre de progression mensuelle
- Tester changement de couleur selon status
- Tester ouverture modal stats
- Tester animation nouveau record (une seule fois)
- VÃ©rifier pas d'animations enfantines

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-17 | 0.1 | Initial story creation | PO Sarah |
